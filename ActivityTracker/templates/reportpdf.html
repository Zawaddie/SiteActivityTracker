{% extends 'basedash.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">
    <div class="col-md-12">
        <div class="text-center mb-4">
            <h2>Activity and Issue Report</h2>
            <p><strong>Report Generated By:</strong> {{ user.get_full_name }}</p>
            <p><img src="{% static 'images/LOGO.png' %}" alt="Company Logo" class="img-fluid" style="max-height: 100px;"></p>
        </div>
        {% if activities or issues %}
        <div class="report mt-4">
            {% for date in dates %}
            <h3>Report for {{ date }}</h3>
            <h4>Activity Report</h4>
            {% for activity in activities %}
                {% if activity.date|stringformat:"Y-m-d" == date %}
                <p><strong>Date:</strong> {{ activity.date }}</p>
                <p><strong>Site Name:</strong> {{ activity.site_name }}</p>
                <p><strong>Site Type:</strong> {{ activity.site_type }}</p>
                <p><strong>Work Completed:</strong> {{ activity.work_completed }}</p>
                <p><strong>Equipment Used:</strong> {{ activity.equipment_used }}</p>
                <p><strong>Materials Used:</strong> {{ activity.materials_used }}</p>
                <hr>
                {% endif %}
            {% endfor %}
            <h4>Issue Report</h4>
            {% for issue in issues %}
                {% if issue.issue_date|stringformat:"Y-m-d" == date %}
                <p><strong>Date:</strong> {{ issue.issue_date }}</p>
                <p><strong>Site Name:</strong> {{ issue.site_name }}</p>
                <p><strong>Site Type:</strong> {{ issue.site_type }}</p>
                <p><strong>Issue Description:</strong> {{ issue.issue_description }}</p>
                <p><strong>Resolution Steps:</strong> {{ issue.resolution_steps }}</p>
                <p><strong>Status:</strong> {{ issue.issue_status }}</p>
                <hr>
                {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
        <form action="{% url 'download_report' %}" method="get">
            <input type="hidden" name="dates" value="{{ dates }}">
            <button type="submit" class="btn btn-success mt-2">Download PDF Report</button>
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}
